<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analog Portfolio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Roboto+Mono:wght@400;500&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --cable-colors: #facc15, #6b7280, #fb923c;
            --screen-tint-color: transparent;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
        }
        .font-mono-custom { font-family: 'Roboto Mono', monospace; }
        .font-serif-custom { font-family: 'Playfair Display', serif; }
        .analog-bg { background-color: #e5e7eb; }
        .module-border { border: 1px solid #9ca3af; }
        .jack {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .jack-output-yellow {
             background: radial-gradient(circle, #fde047 40%, #facc15 100%);
             border: 2px solid #eab308;
        }
        .jack-output-modulation {
             background: radial-gradient(circle, #6b7280 40%, #374151 100%);
             border: 2px solid #9ca3af;
        }
        .jack-input {
            background: radial-gradient(circle, #1f2937 40%, #000 100%);
            border: 2px solid #374151;
        }
        .jack-input-red {
             background: radial-gradient(circle, #ef4444 40%, #b91c1c 100%);
             border: 2px solid #dc2626;
        }
        .jack-input-purple {
            background: radial-gradient(circle, #a78bfa 40%, #7c3aed 100%);
            border: 2px solid #8b5cf6;
        }
        .jack:hover, .jack.selected {
            transform: scale(1.1);
            border-color: #f59e0b;
        }
        .jack-label {
            font-family: 'Roboto Mono', monospace;
            font-size: 10px;
            text-transform: uppercase;
            color: #4b5563;
            text-align: center;
        }
        .knob {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(145deg, #262626, #1a1a1a);
            border: 2px solid #404040;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.4), inset 0 2px 2px rgba(255,255,255,0.1);
        }
        .knob::after {
            content: '';
            position: absolute;
            width: 4px;
            height: 12px;
            background-color: #d1d5db;
            top: 6px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 2px;
        }
        .screen {
            background-color: #a3b18a;
            border: 4px solid #344e41;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.5);
            color: #3a5a40;
            height: 300px;
            overflow-y: auto;
            transition: filter 0.1s linear, font-family 0.1s linear;
            position: relative;
        }
        .screen a {
            text-decoration: underline;
            color: #2c422f;
        }
        .screen a:hover {
            color: #1a2a1c;
        }
        .screen::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--screen-tint-color);
            transition: background-color 0.1s linear;
            z-index: 1;
            pointer-events: none;
        }
        .screen > * {
            position: relative;
            z-index: 2;
        }
        #patching-area {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        .patch-cable {
            stroke-width: 5;
            fill: none;
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.4));
            pointer-events: auto;
            cursor: pointer;
            transition: stroke-width 0.1s ease;
        }
        .patch-cable:hover {
            stroke-width: 8;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="analog-computer" class="analog-bg rounded-lg shadow-2xl w-full max-w-4xl p-4 sm:p-6 relative">
        <svg id="patching-area"></svg>

        <div class="flex justify-between items-center pb-4 border-b-2 border-gray-400 relative z-1">
            <h1 class="text-xl sm:text-2xl font-bold text-gray-700 tracking-wider">Mat Dalgleish</h1>
            <div class="flex items-center space-x-4">
                <div class="text-center">
                    <span class="font-mono-custom text-xs text-gray-600">MASTER IN</span>
                    <div id="master-in" class="jack jack-input jack-input-red" data-name="master-in" data-type="content"></div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mt-4 relative z-1">
            <div class="lg:col-span-1 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-2 gap-4">
                
                <div class="module-border rounded p-3 text-center"><h2 class="font-mono-custom font-bold text-gray-600 text-sm">ABOUT</h2><div class="flex justify-center mt-3"><div class="jack jack-output-yellow" data-type="content-source" data-color="#facc15" data-content="about"></div></div><p class="jack-label mt-2">OUT</p></div>
                <div class="module-border rounded p-3 text-center"><h2 class="font-mono-custom font-bold text-gray-600 text-sm">PROJECTS</h2><div class="flex justify-center mt-3"><div class="jack jack-output-yellow" data-type="content-source" data-color="#facc15" data-content="projects"></div></div><p class="jack-label mt-2">OUT</p></div>
                <div class="module-border rounded p-3 text-center"><h2 class="font-mono-custom font-bold text-gray-600 text-sm">WRITING</h2><div class="flex justify-center mt-3"><div class="jack jack-output-yellow" data-type="content-source" data-color="#facc15" data-content="writing"></div></div><p class="jack-label mt-2">OUT</p></div>
                <div class="module-border rounded p-3 text-center"><h2 class="font-mono-custom font-bold text-gray-600 text-sm">SKILLS</h2><div class="flex justify-center mt-3"><div class="jack jack-output-yellow" data-type="content-source" data-color="#facc15" data-content="skills"></div></div><p class="jack-label mt-2">OUT</p></div>
                <div class="module-border rounded p-3 text-center"><h2 class="font-mono-custom font-bold text-gray-600 text-sm">CONTACT</h2><div class="flex justify-center mt-3"><div class="jack jack-output-yellow" data-type="content-source" data-color="#facc15" data-content="contact"></div></div><p class="jack-label mt-2">OUT</p></div>
                <div class="module-border rounded p-3 text-center bg-gray-300"><h2 class="font-mono-custom font-bold text-gray-600 text-sm">SEQUENCER</h2><div class="flex justify-center mt-3"><div id="sequencer-in" class="jack jack-input jack-input-red" data-name="sequencer-in" data-type="sequencer-in"></div></div><p class="jack-label mt-2">STEP</p></div>

            </div>

            <div class="lg:col-span-2">
                <div id="content-screen" class="screen font-mono-custom rounded-lg p-6 text-lg leading-relaxed">
                    <p class="text-2xl font-bold animate-pulse">> WAITING FOR INPUT...</p>
                    <p class="mt-4">Patch a module's <span class="font-bold">OUTPUT</span> to the <span class="font-bold">MASTER IN</span> jack to display content.</p>
                </div>
                 <div class="module-border rounded p-3 mt-4">
                    <div class="flex justify-around items-center">
                         <div class="text-center"><span class="font-mono-custom text-xs text-gray-600">FONT</span><div id="font-in" class="jack jack-input jack-input-purple" data-name="font-in" data-type="font"></div></div>
                         <div class="text-center"><span class="font-mono-custom text-xs text-gray-600">COLOR</span><div id="color-in" class="jack jack-input jack-input-purple" data-name="color-in" data-type="color"></div></div>
                         <div class="text-center"><span class="font-mono-custom text-xs text-gray-600">CONTRAST</span><div id="contrast-in" class="jack jack-input jack-input-purple" data-name="contrast-in" data-type="contrast"></div></div>
                         <div class="text-center"><span class="font-mono-custom text-xs text-gray-600">BRIGHTNESS</span><div id="brightness-in" class="jack jack-input jack-input-purple" data-name="brightness-in" data-type="brightness"></div></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-6 pt-4 border-t-2 border-gray-400">
             <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <div class="module-border rounded p-3 flex flex-col justify-between"><h2 class="font-mono-custom font-bold text-gray-600 text-sm text-center">LFO 1</h2><div class="flex justify-around items-center my-auto"><div class="text-center"><div class="jack jack-output-modulation" data-type="lfo-source" data-effect="lfo1Sine" data-color="#6b7280"></div><p class="jack-label mt-2">SINE</p></div><div class="text-center"><div class="jack jack-output-modulation" data-type="lfo-source" data-effect="lfo1Square" data-color="#6b7280"></div><p class="jack-label mt-2">SQUARE</p></div></div><div class="border-t border-gray-400 mt-3 pt-3 flex justify-around items-center"><div class="knob-container"><div class="knob" id="lfo1-rate-knob"></div><p class="jack-label mt-2">RATE</p></div></div></div>
                <div class="module-border rounded p-3 flex flex-col justify-between"><h2 class="font-mono-custom font-bold text-gray-600 text-sm text-center">LFO 2</h2><div class="flex justify-around items-center my-auto"><div class="text-center"><div class="jack jack-output-modulation" data-type="lfo-source" data-effect="lfo2Sine" data-color="#6b7280"></div><p class="jack-label mt-2">SINE</p></div><div class="text-center"><div class="jack jack-output-modulation" data-type="lfo-source" data-effect="lfo2Square" data-color="#6b7280"></div><p class="jack-label mt-2">SQUARE</p></div></div><div class="border-t border-gray-400 mt-3 pt-3 flex justify-around items-center"><div class="knob-container"><div class="knob" id="lfo2-rate-knob"></div><p class="jack-label mt-2">RATE</p></div></div></div>
                <div class="module-border rounded p-3 flex flex-col justify-between"><h2 class="font-mono-custom font-bold text-gray-600 text-sm text-center">LFO 3</h2><div class="flex justify-around items-center my-auto"><div class="text-center"><div class="jack jack-output-modulation" data-type="lfo-source" data-effect="lfo3Sine" data-color="#6b7280"></div><p class="jack-label mt-2">SINE</p></div><div class="text-center"><div class="jack jack-output-modulation" data-type="lfo-source" data-effect="lfo3Square" data-color="#6b7280"></div><p class="jack-label mt-2">SQUARE</p></div></div><div class="border-t border-gray-400 mt-3 pt-3 flex justify-around items-center"><div class="knob-container"><div class="knob" id="lfo3-rate-knob"></div><p class="jack-label mt-2">RATE</p></div></div></div>
                <div class="module-border rounded p-3">
                    <h2 class="font-mono-custom font-bold text-gray-600 text-sm text-center">CLOCK DIVIDER</h2>
                    <div class="flex justify-around items-center mt-3">
                        <div class="text-center"><p class="jack-label mb-2">IN</p><div class="jack jack-input" data-name="clock-in" data-type="clock-in"></div></div>
                        <div class="text-center"><div class="jack jack-output-modulation" data-type="logic-output" data-effect="div2" data-color="#fb923c"></div><p class="jack-label mt-2">/2</p></div>
                        <div class="text-center"><div class="jack jack-output-modulation" data-type="logic-output" data-effect="div4" data-color="#fb923c"></div><p class="jack-label mt-2">/4</p></div>
                        <div class="text-center"><div class="jack jack-output-modulation" data-type="logic-output" data-effect="div8" data-color="#fb923c"></div><p class="jack-label mt-2">/8</p></div>
                    </div>
                </div>
             </div>
        </div>
    </div>

    <script>
        const contentData = {
            about: { title: "ABOUT", body: "Dr. Mat Dalgleish is a researcher, educator, and artist-designer working at the intersection of people, music and audiovisual technology, and accessibility. He is also a congenitally one-handed musician. Mat has previously worked at The OU Music Computing Lab and led postgraduate performing arts provision at the University of Wolverhampton. He is currently Senior Lecturer in Game Audio at the University of Staffordshire, a Leonardo CripTech AI Lab fellow, an Accessibility Chair of NIME 2026, and a trustee of The OHMI Trust." },
            projects: { title: "PROJECTS", body: `My individual and collaborative projects include The Accessible Modular, TYG, Beyond Audio Description for Theatre, Postrum, the Haptic Dum Kit/Haptic Bracelets, Song Walker Harmony Space, and Eden3. For more details see <a href="https://docs.google.com/document/d/e/2PACX-1vQBKxhNHR22llVVyb7lFHR8Jngwx01rJS5nBMP2wVCuKoUxUsCw1RFh_qu_4S1yt9-BjqgZliCZgn-v/pub" target="_blank">HERE</a>.` },
            writing: { title: "WRITING", body: `I write about audio/sound/music, technology, and accessibility, with a particular focus on instrument design. You can find an up-to-date Publications list <a href="https://docs.google.com/document/d/e/2PACX-1vTNOwfFbUrv_nqlR6ShIRcVnj5GEn1ZFPu_fGBX59fz_2sOvSxgLoEaA9-HjJCEg0bTqz58g6V2cN5z/pub" target="_blank">HERE</a>.` },
            skills: { title: "SKILLS", body: "I am an experienced educator and since 2007 I have taught music/audio technology, game design, programming, interactive media, musical theatre, and fine art (film) students at levels 3-7. I have also successfully supervised 2 PhD students and more than 130 other postgraduate projects. I am also experienced in course design and (re)validation, having designed and successfully validated 9 courses (levels 4-7) for several UK and international institutions.\n\nI am fluent in the use of a variety of specialist software, including Pure Data, Max, SuperCollider, Logic Pro, Ableton, Pro Tools, Audacity, Processing, Unreal Engine (MetaSounds), and hardware, including Arduino, Beaglebone, Bela, and Raspberry Pi platforms. Where possible, I use and support open source hardware and software." },
            contact: { title: "CONTACT", body: "You can reach me via:\n\nEMAIL: mathewdalgleish@gmail.com" },
        };

        const computer = document.getElementById('analog-computer');
        const svgArea = document.getElementById('patching-area');
        const contentScreen = document.getElementById('content-screen');
        const outputJacks = document.querySelectorAll('.jack-output-yellow, .jack-output-modulation');
        const inputJacks = document.querySelectorAll('.jack-input');

        let selectedOutput = null;
        let activeCables = [];

        const systemState = {
            lfo1: { rate: 5 },
            lfo2: { rate: 5 },
            lfo3: { rate: 5 },
            clockDivider: { in: null, counter: 0, prevClockState: false, out: { div2: false, div4: false, div8: false } },
            sequencer: { in: null, step: 0, contentOrder: ['about', 'projects', 'writing', 'skills', 'contact'], prevClockState: false },
            brightnessSource: null,
            colorSource: null,
            contrastSource: null,
            fontSource: null,
            time: 0
        };

        function getJackCenter(element) {
            const rect = element.getBoundingClientRect();
            const computerRect = computer.getBoundingClientRect();
            return { x: rect.left - computerRect.left + rect.width / 2, y: rect.top - computerRect.top + rect.height / 2 };
        }

        function drawCable(startPoint, endPoint, color) {
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            const sag = Math.max(Math.abs(startPoint.y - endPoint.y) * 0.8, Math.abs(startPoint.x - endPoint.x) * 0.3, 80);
            const pathData = `M ${startPoint.x} ${startPoint.y} C ${startPoint.x} ${startPoint.y + sag}, ${endPoint.x} ${endPoint.y + sag}, ${endPoint.x} ${endPoint.y}`;
            path.setAttribute('d', pathData);
            path.setAttribute('stroke', color);
            path.classList.add('patch-cable');
            svgArea.appendChild(path);
            return path;
        }
        
        function updateContent(contentKey) {
            const content = contentData[contentKey];
            if (content) {
                contentScreen.innerHTML = `<h2 class="text-2xl font-bold mb-4 border-b-2 border-green-800/30 pb-2">${content.title}</h2><p class="whitespace-pre-wrap">${content.body}</p>`;
            }
        }
        
        function resetScreen() {
             contentScreen.innerHTML = `<p class="text-2xl font-bold animate-pulse">> WAITING FOR INPUT...</p><p class="mt-4">Patch a module's <span class="font-bold">OUTPUT</span> to the <span class="font-bold">MASTER IN</span> jack to display content. Click a cable to remove it.</p>`;
        }

        function showError() {
            contentScreen.innerHTML = `<h2 class="text-2xl font-bold text-red-600 animate-pulse">! ERROR !</h2><p class="mt-4">MULTIPLE SIGNALS DETECTED AT MASTER INPUT.</p>`;
        }
        
        function getRawSignal(source) {
            if (!source) return 0;
            const t = systemState.time;
            switch(source) {
                case 'lfo1Sine': return Math.sin(t * systemState.lfo1.rate);
                case 'lfo1Square': return Math.sin(t * systemState.lfo1.rate) > 0 ? 1 : -1;
                case 'lfo2Sine': return Math.sin(t * systemState.lfo2.rate);
                case 'lfo2Square': return Math.sin(t * systemState.lfo2.rate) > 0 ? 1 : -1;
                case 'lfo3Sine': return Math.sin(t * systemState.lfo3.rate);
                case 'lfo3Square': return Math.sin(t * systemState.lfo3.rate) > 0 ? 1 : -1;
                default: return 0;
            }
        }

        function getFinalSignal(source) {
            if (!source) return false;
            if (systemState.clockDivider.out.hasOwnProperty(source)) return systemState.clockDivider.out[source];
            return getRawSignal(source) > 0;
        }

        function systemClock() {
            systemState.time += 0.02;

            // Clock Divider
            const clockSignal = getRawSignal(systemState.clockDivider.in) > 0;
            if (clockSignal && !systemState.clockDivider.prevClockState) {
                systemState.clockDivider.counter++;
            }
            systemState.clockDivider.prevClockState = clockSignal;
            systemState.clockDivider.out.div2 = Math.floor(systemState.clockDivider.counter / 1) % 2 === 0;
            systemState.clockDivider.out.div4 = Math.floor(systemState.clockDivider.counter / 2) % 2 === 0;
            systemState.clockDivider.out.div8 = Math.floor(systemState.clockDivider.counter / 4) % 2 === 0;

             // Sequencer
            const seqClockSignal = getFinalSignal(systemState.sequencer.in);
            if (seqClockSignal && !systemState.sequencer.prevClockState) {
                systemState.sequencer.step = (systemState.sequencer.step + 1) % systemState.sequencer.contentOrder.length;
                const currentContent = systemState.sequencer.contentOrder[systemState.sequencer.step];
                updateContent(currentContent);
            }
            systemState.sequencer.prevClockState = seqClockSignal;
            
            // Screen Effects
            const brightnessSignal = getFinalSignal(systemState.brightnessSource);
            const contrastSignal = getFinalSignal(systemState.contrastSource);
            const fontSignal = getFinalSignal(systemState.fontSource);

            const brightnessValue = brightnessSignal ? 1.2 : 0.9;
            const contrastValue = contrastSignal ? 1.5 : 0.7;
            
            let colorValue = 'transparent';
            if (systemState.colorSource) {
                const rawColorSignal = getRawSignal(systemState.colorSource); // Value from -1 to 1
                const normalizedSignal = (rawColorSignal + 1) / 2; // Maps [-1, 1] to [0, 1]
                const hue = normalizedSignal * 360;
                colorValue = `hsla(${hue}, 70%, 60%, 0.2)`;
            }
            
            contentScreen.style.filter = `brightness(${brightnessValue}) contrast(${contrastValue})`;
            contentScreen.style.setProperty('--screen-tint-color', colorValue);

            if (fontSignal) {
                contentScreen.classList.remove('font-mono-custom');
                contentScreen.classList.add('font-serif-custom');
            } else {
                contentScreen.classList.add('font-mono-custom');
                contentScreen.classList.remove('font-serif-custom');
            }

            requestAnimationFrame(systemClock);
        }

        function deleteCable(cableToDelete) {
            const index = activeCables.findIndex(c => c === cableToDelete);
            if (index === -1) return;
            svgArea.removeChild(cableToDelete.path);
            activeCables.splice(index, 1);
            const destType = cableToDelete.endEl.dataset.type;
            if (destType === 'content') {
                const masterInConnections = activeCables.filter(c => c.endEl.dataset.type === 'content');
                if (masterInConnections.length > 1) {
                    showError();
                } else if (masterInConnections.length === 1) {
                    updateContent(masterInConnections[0].content);
                } else {
                    if (!systemState.sequencer.in) resetScreen();
                }
            } else if (destType === 'brightness') {
                systemState.brightnessSource = null;
            } else if (destType === 'color') {
                systemState.colorSource = null;
            } else if (destType === 'contrast') {
                systemState.contrastSource = null;
            } else if (destType === 'font') {
                systemState.fontSource = null;
            } else if (destType === 'clock-in') {
                systemState.clockDivider.in = null;
            } else if (destType === 'sequencer-in') {
                systemState.sequencer.in = null;
            }
        }

        function setupKnob(knobEl, targetState, minVal, maxVal, initialAngle = 0) {
            let isDragging = false, currentAngle = initialAngle, startY = 0, startAngle = 0;
            knobEl.style.transform = `rotate(${currentAngle}deg)`;
            knobEl.addEventListener('mousedown', (e) => {
                e.preventDefault(); isDragging = true; startY = e.clientY; startAngle = currentAngle;
                document.body.style.cursor = 'ns-resize';
            });
            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                const deltaY = startY - e.clientY;
                currentAngle = Math.max(-135, Math.min(135, startAngle + deltaY * 1.5));
                knobEl.style.transform = `rotate(${currentAngle}deg)`;
                const value = ((currentAngle + 135) / 270) * (maxVal - minVal) + minVal;
                const path = targetState.split('.');
                let obj = systemState;
                for(let i = 0; i < path.length - 1; i++) obj = obj[path[i]];
                obj[path[path.length - 1]] = value;
            });
            document.addEventListener('mouseup', () => { isDragging = false; document.body.style.cursor = 'default'; });
        }

        setupKnob(document.getElementById('lfo1-rate-knob'), 'lfo1.rate', 0.1, 10, -90);
        setupKnob(document.getElementById('lfo2-rate-knob'), 'lfo2.rate', 0.1, 10, -90);
        setupKnob(document.getElementById('lfo3-rate-knob'), 'lfo3.rate', 0.1, 10, -90);

        outputJacks.forEach(jack => jack.addEventListener('click', () => {
            if (selectedOutput) selectedOutput.classList.remove('selected');
            selectedOutput = jack;
            selectedOutput.classList.add('selected');
        }));

        inputJacks.forEach(inputJack => inputJack.addEventListener('click', () => {
            if (!selectedOutput) return;
            const sourceType = selectedOutput.dataset.type;
            const destType = inputJack.dataset.type;

            const isModSource = sourceType === 'lfo-source' || sourceType === 'logic-output';
            const isModDest = ['brightness', 'color', 'contrast', 'font', 'clock-in', 'sequencer-in'].includes(destType);

            const isValidPatch = 
                (sourceType === 'content-source' && destType === 'content') ||
                (isModSource && isModDest);

            if (!isValidPatch) {
                selectedOutput.classList.remove('selected');
                selectedOutput = null;
                return;
            }

            const startPoint = getJackCenter(selectedOutput);
            const endPoint = getJackCenter(inputJack);
            const cableElement = drawCable(startPoint, endPoint, selectedOutput.dataset.color);
            const cableData = {
                startEl: selectedOutput, endEl: inputJack, path: cableElement,
                content: selectedOutput.dataset.content, effect: selectedOutput.dataset.effect
            };
            cableElement.addEventListener('click', () => deleteCable(cableData));
            activeCables.push(cableData);

            if (destType === 'content') {
                 if (!systemState.sequencer.in) {
                    const masterInConnections = activeCables.filter(c => c.endEl.dataset.type === 'content');
                    if (masterInConnections.length > 1) {
                        showError();
                    } else {
                        updateContent(cableData.content);
                    }
                 }
            }
            else if (destType === 'brightness') systemState.brightnessSource = cableData.effect;
            else if (destType === 'color') systemState.colorSource = cableData.effect;
            else if (destType === 'contrast') systemState.contrastSource = cableData.effect;
            else if (destType === 'font') systemState.fontSource = cableData.effect;
            else if (destType === 'clock-in') systemState.clockDivider.in = cableData.effect;
            else if (destType === 'sequencer-in') systemState.sequencer.in = cableData.effect;

            selectedOutput.classList.remove('selected');
            selectedOutput = null;
        }));
        
        document.getElementById('clear-patches')?.addEventListener('click', () => {
            svgArea.innerHTML = '';
            activeCables = [];
            resetScreen();
            systemState.brightnessSource = null;
            systemState.colorSource = null;
            systemState.contrastSource = null;
            systemState.fontSource = null;
            systemState.clockDivider.in = null;
            systemState.sequencer.in = null;
            if(selectedOutput) {
                 selectedOutput.classList.remove('selected');
                 selectedOutput = null;
            }
        });

        window.addEventListener('resize', () => {
            activeCables.forEach(cable => {
                const startPoint = getJackCenter(cable.startEl);
                const endPoint = getJackCenter(cable.endEl);
                const sag = Math.max(Math.abs(startPoint.y - endPoint.y) * 0.8, Math.abs(startPoint.x - endPoint.x) * 0.3, 80);
                cable.path.setAttribute('d', `M ${startPoint.x} ${startPoint.y} C ${startPoint.x} ${startPoint.y + sag}, ${endPoint.x} ${endPoint.y + sag}, ${endPoint.x} ${endPoint.y}`);
            });
        });

        systemClock();
    </script>
</body>
</html>




