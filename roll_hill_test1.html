<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Asymmetric Toy Car â€” Vertical Slope</title>
  <style>
    body { margin: 0; background: #fff; overflow: hidden; }
    canvas { display: block; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>
</head>
<body>
<script>
let g = 500;       // gravity (px/s^2)
let mu = 0.05;     // rolling resistance
let car;

let presets = [
  {Rl: 30, Rr: 30, label: "Symmetric"},
  {Rl: 22, Rr: 30, label: "Asymmetric"},
];
let presetIdx = 0;

let trail = [];

function setup() {
  createCanvas(windowWidth, windowHeight);
  textFont("monospace");
  resetSim();
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
  resetSim();
}

function resetSim() {
  car = {
    x: width/2,         // centered horizontally
    y: 60,              // near the top
    heading: HALF_PI,   // facing downward
    v: 0,
    wbase: 70,
    Rl: presets[presetIdx].Rl,
    Rr: presets[presetIdx].Rr,
  };
  trail = [];
}

function draw() {
  background(255);
  updatePhysics(deltaTime/1000);
  recordTrail();
  drawSlope();
  drawTrail();
  drawCar();
  drawHUD();
}

function drawSlope() {
  stroke(0);
  strokeWeight(2);
  // Vertical slope line
  line(width/2, 0, width/2, height);
}

function updatePhysics(dt) {
  // Forward acceleration (downwards)
  let a = g - mu * g;
  car.v += a * dt;
  car.v = max(car.v, 0);

  // Differential effect from wheel radii
  let Rref = 30;
  let uL = car.v * (Rref / car.Rl);
  let uR = car.v * (Rref / car.Rr);
  let v_body = 0.5 * (uL + uR);
  let yawRate = (uR - uL) / car.wbase;

  car.heading += yawRate * dt;
  car.x += cos(car.heading) * v_body * dt;
  car.y += sin(car.heading) * v_body * dt;

  // Reset if off-screen
  if (car.y > height + 100 || car.x < -100 || car.x > width+100) {
    resetSim();
  }
}

function drawCar() {
  let axle = car.wbase;
  let L = createVector(0, 0.5 * axle);
  let R = createVector(0, -0.5 * axle);
  let pC = createVector(car.x, car.y);

  let ex = createVector(cos(car.heading), sin(car.heading));
  let ey = createVector(-sin(car.heading), cos(car.heading));

  let pL = p5.Vector.add(pC, p5.Vector.add(p5.Vector.mult(ey, L.y), p5.Vector.mult(ex, L.x)));
  let pR = p5.Vector.add(pC, p5.Vector.add(p5.Vector.mult(ey, R.y), p5.Vector.mult(ex, R.x)));

  stroke(0);
  strokeWeight(2);
  noFill();
  line(pL.x, pL.y, pR.x, pR.y);
  circle(pL.x, pL.y, 2*car.Rl);
  circle(pR.x, pR.y, 2*car.Rr);

  let nose = p5.Vector.add(pC, p5.Vector.mult(ex, 28));
  line(pC.x, pC.y, nose.x, nose.y);
}

function recordTrail() {
  trail.push(createVector(car.x, car.y));
  if (trail.length > 800) trail.shift();
}

function drawTrail() {
  if (trail.length < 2) return;
  stroke(0,80);
  strokeWeight(1);
  noFill();
  beginShape();
  for (let v of trail) vertex(v.x, v.y);
  endShape();
}

function drawHUD() {
  noStroke();
  fill(0);
  textSize(14);
  text(`Preset: ${presets[presetIdx].label}`, 12, 20);
  text(`Wheel radii L/R: ${car.Rl} / ${car.Rr}`, 12, 40);
  text("SPACE: change preset   R: reset", 12, 60);
}

function keyPressed() {
  if (key === ' ') {
    presetIdx = (presetIdx + 1) % presets.length;
    car.Rl = presets[presetIdx].Rl;
    car.Rr = presets[presetIdx].Rr;
  } else if (key === 'R' || key === 'r') {
    resetSim();
  }
}
</script>
</body>
</html>

