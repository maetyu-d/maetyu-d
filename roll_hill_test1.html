<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Asymmetric Toy Car — Damped Descent with Bumpers (Green Trail)</title>
  <style>
    body { margin: 0; background: #fff; overflow: hidden; }
    canvas { display: block; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>
</head>
<body>
<script>
// +Y is DOWNHILL.
//
// Hybrid world/body model with damped back-and-forth descent,
// green trail, and vertical bumpers down both sides of the ramp.
// - World velocity (vx, vy) integrates gravity and resistances.
// - Yaw uses signed forward speed s = v · ex (no spin at rest).
// - Heading is second-order (under-damped) so it rings down naturally.
// - Bumpers: vertical walls parallel to ramp centreline; collisions reflect vx,
//   damp vy and angular velocity, and de-penetrate using wheel edge contact.
//
// Starts top-centre, nose down, right wheel > left so it naturally veers.

let g = 480;          // gravity (px/s^2)
let mu = 0.045;       // rolling resistance (Coulomb-like)
let c_v = 0.8;        // viscous drag on forward motion (1/s)

let k_align = 2.2;    // spring to align nose to fall line (HALF_PI)
let c_align = 1.2;    // angular damping
let yaw_wheel_gain = 1.0;

let bumperHalf = 180; // half-width from centreline to each bumper (px)
let e_bounce = 0.35;  // coefficient of restitution for wall bounce
let wall_damp_vy = 0.90; // damp vertical speed on bounce
let wall_damp_w  = 0.70; // damp angular speed on bounce

let car;
const presets = [
  {Rl: 24, Rr: 32, label: "Asymmetric (R > L)"}, // default
  {Rl: 30, Rr: 30, label: "Symmetric"},
  {Rl: 18, Rr: 36, label: "Strong asymmetry"},
];
let presetIdx = 0;

let trail = [];
let showTrail = true;

function setup() {
  createCanvas(windowWidth, windowHeight);
  textFont("monospace");
  resetSim();
}
function windowResized(){ resizeCanvas(windowWidth, windowHeight); resetSim(); }

function resetSim() {
  car = {
    x: width/2,
    y: 60,              // top of slope
    theta: HALF_PI,     // heading (nose) angle; HALF_PI = straight down
    w: 0,               // angular velocity (rad/s)
    vx: 0, vy: 0,       // world velocity
    wbase: 70,          // axle separation proxy (px)
    Rl: presets[presetIdx].Rl,
    Rr: presets[presetIdx].Rr,
  };
  trail = [];
}

function draw() {
  background(255);
  const dt = Math.min(1/30, (deltaTime || 0) / 1000);
  updatePhysics(dt);
  if (showTrail) recordTrail();
  drawSlopeAn
