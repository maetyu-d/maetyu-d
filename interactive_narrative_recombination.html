<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rule-Based Narrative Recombination</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .story-fragment {
            transition: opacity 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-3xl mx-auto bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-10">
        <!-- Header Section -->
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-indigo-600 dark:text-indigo-400">Narrative Fragment Recombinator</h1>
            <p class="text-gray-600 dark:text-gray-400 mt-2">Customize the story structure below, then generate a new narrative.</p>
        </div>

        <!-- Rule Customization Area -->
        <div class="mb-8 p-6 bg-gray-50 dark:bg-gray-700 rounded-xl">
            <h2 class="text-xl font-bold mb-4 text-center">Story Structure Rules</h2>
            <div id="rules-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-4">
                <!-- Dropdown menus for rules will be dynamically inserted here -->
            </div>
        </div>

        <!-- Action Button -->
        <div class="text-center mb-8">
            <button id="generate-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transform hover:scale-105 transition-all duration-300 ease-in-out focus:outline-none focus:ring-4 focus:ring-indigo-300 dark:focus:ring-indigo-800">
                Generate Story
            </button>
        </div>

        <!-- Story Display Area -->
        <div id="story-output" class="p-6 bg-gray-100 dark:bg-gray-900 rounded-xl min-h-[200px] space-y-6 text-lg leading-relaxed">
            <p class="text-gray-500 dark:text-gray-400 italic">Your generated story and its rules will appear here...</p>
        </div>
    </div>

    <script>
        // --- DATA: Narrative Fragments ---
        const fragments = {
            setting: [
                "The story begins in a windswept city of towering brass spires, where clockwork birds sang melodies of forgotten times.",
                "It all started in a quiet, forgotten library, where books whispered secrets to those who knew how to listen.",
                "Our tale unfolds deep within an ancient forest, where sunlight dappled through the canopy like liquid gold.",
                "The scene is a bustling starport on a distant moon, the air thick with the scent of alien spices and rocket fuel."
            ],
            character: [
                "The protagonist was a clever detective with a knack for noticing the smallest, most insignificant details.",
                "We follow a young sorceress, whose power was as untamed and wild as the storms she could summon.",
                "Our hero is a grizzled space captain, who had seen more galaxies than they could count.",
                "The main character is a shy inventor, more comfortable with gears and circuits than with people."
            ],
            inciting_incident: [
                "One day, a mysterious, unmarked package arrived, containing an artifact that hummed with a strange energy.",
                "Everything changed when a cryptic message was discovered, hinting at a legendary treasure hidden long ago.",
                "Their peaceful life was shattered by the arrival of a dire prophecy, foretelling a great darkness to come.",
                "A desperate plea for help from a neighboring kingdom set them on an unexpected and perilous journey."
            ],
            goal: [
                "They knew they had to unlock the artifact's secrets before it fell into the wrong hands.",
                "The quest was clear: find the legendary treasure, no matter the cost.",
                "Their mission was to find a way to prevent the prophecy from coming true.",
                "They vowed to help the kingdom and face the looming threat head-on."
            ],
            climax: [
                "In a tense confrontation, they faced the villain, the fate of the world hanging in the balance.",
                "After a long and arduous search, they finally stood before the treasure, but it was guarded by a fearsome beast.",
                "At the heart of the storm, they unleashed their full power, a blinding flash of light that shook the very foundations of the earth.",
                "The final puzzle piece clicked into place, revealing a truth more shocking than they could have ever imagined."
            ],
            resolution: [
                "With the artifact secured, a new era of peace and prosperity began.",
                "The treasure was not gold or jewels, but ancient wisdom that would guide their people for generations.",
                "The darkness was averted, and the hero, though changed by their journey, returned home to a joyous celebration.",
                "The kingdom was saved, and a strong alliance was forged, promising a brighter future for all."
            ]
        };

        // --- RULES: The *Initial* Narrative Structure ---
        // This array defines the default order for the dropdowns.
        const initialStoryStructure = [
            'setting',
            'character',
            'inciting_incident',
            'goal',
            'climax',
            'resolution'
        ];

        // --- LOGIC: Story Generation & UI ---
        const storyOutput = document.getElementById('story-output');
        const generateBtn = document.getElementById('generate-btn');
        const rulesContainer = document.getElementById('rules-container');

        /**
         * Creates and populates the dropdown menus for customizing the story structure.
         */
        function createRuleSelectors() {
            rulesContainer.innerHTML = ''; // Clear existing selectors
            const fragmentCategories = Object.keys(fragments);

            initialStoryStructure.forEach((rule, index) => {
                const selectWrapper = document.createElement('div');
                selectWrapper.className = 'flex flex-col items-center';

                const label = document.createElement('label');
                label.textContent = `Step ${index + 1}`;
                label.className = 'text-sm font-medium text-gray-500 dark:text-gray-400 mb-1';

                const select = document.createElement('select');
                select.className = 'w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm py-2 px-3 text-center focus:outline-none focus:ring-2 focus:ring-indigo-500';

                fragmentCategories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    // Capitalize first letter and replace underscore for display
                    option.textContent = category.replace('_', ' ').replace(/^\w/, c => c.toUpperCase());
                    if (category === rule) {
                        option.selected = true;
                    }
                    select.appendChild(option);
                });
                
                selectWrapper.appendChild(label);
                selectWrapper.appendChild(select);
                rulesContainer.appendChild(selectWrapper);
            });
        }

        /**
         * Selects a random element from an array.
         * @param {Array} arr - The array to pick from.
         * @returns {*} A random element from the array.
         */
        function getRandomElement(arr) {
            if (!arr || arr.length === 0) {
                return "[No fragment available for this rule]";
            }
            return arr[Math.floor(Math.random() * arr.length)];
        }

        /**
         * Generates a new story based on the user-defined structure and fragments.
         */
        function generateStory() {
            // 1. Read the current story structure from the dropdowns
            const ruleSelectors = document.querySelectorAll('#rules-container select');
            const currentStoryStructure = Array.from(ruleSelectors).map(select => select.value);

            // 2. Clear the previous story
            storyOutput.innerHTML = '';

            // 3. Follow the new story structure rules to build the narrative
            currentStoryStructure.forEach((category, index) => {
                const availableFragments = fragments[category];
                const selectedFragment = getRandomElement(availableFragments);
                
                // Create elements for the parallel display
                const rowElement = document.createElement('div');
                rowElement.className = 'story-fragment opacity-0 grid grid-cols-1 md:grid-cols-4 gap-x-6 gap-y-2 items-start';
                
                const ruleElement = document.createElement('div');
                ruleElement.className = 'md:col-span-1 font-semibold text-indigo-500 dark:text-indigo-400 capitalize md:text-right';
                ruleElement.textContent = category.replace('_', ' '); 
                
                const fragmentElement = document.createElement('div');
                fragmentElement.className = 'md:col-span-3';
                fragmentElement.textContent = selectedFragment;

                rowElement.appendChild(ruleElement);
                rowElement.appendChild(fragmentElement);
                storyOutput.appendChild(rowElement);

                // Animate the fragment appearing
                setTimeout(() => {
                    rowElement.classList.remove('opacity-0');
                }, index * 150);
            });
        }

        // --- INITIALIZATION ---
        // Create the rule selectors when the page loads
        document.addEventListener('DOMContentLoaded', createRuleSelectors);
        // Add event listener to the generate button
        generateBtn.addEventListener('click', generateStory);
    </script>
</body>
</html>
